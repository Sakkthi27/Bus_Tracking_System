<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Dashboard</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/hrtclogo.png" rel="icon">
  <link href="assets/img/hrtclogo.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">
</head>

<body>
{% if messages %}
        {% for message in messages %}

        <script>
            alert("{{ message }}");
        </script>

        {% endfor %}
  {% endif %}
<!-- ======= Header ======= -->
<header id="header" class="header fixed-top d-flex align-items-center">

  <div class="d-flex align-items-center justify-content-between">
    <a href="#" class="logo d-flex align-items-center">
      <img src="static/assets/img/hrtclogo.jpg" alt="">
      <span class="d-none d-lg-block">Route Express</span>
    </a>
    <i class="bi bi-list toggle-sidebar-btn"></i>
  </div><!-- End Logo -->


  <nav class="header-nav ms-auto">
    <ul class="d-flex align-items-center">

      <li class="nav-item d-none d-lg-block">
        <h5 id="org">Bus Tracking Service&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h5>
      </li>
      {% if user.is_authenticated %}
  <div class="login_container"><a  class="login" href="/signout"><h4>SignOut</h4></a></div>
  {% else %}
  <div class="login_container"><a  class="login" href="/signup"><h4>Signup</h4></a></div>
  {% endif %}<!-- End Search Icon-->
    </ul>
  </nav><!-- End Icons Navigation -->

</header><!-- End Header -->

<!-- ======= Sidebar ======= -->
<aside id="sidebar" class="sidebar">

  <ul class="sidebar-nav" id="sidebar-nav">

    <li class="nav-heading">Home</li>

    <li class="nav-item">
      <a class="nav-link " href="/">
        <i class="bi bi-house"></i>
        <span>Home</span>
      </a>
    </li>


    <!-- End Dashboard Nav -->

    <li class="nav-heading">Travel</li>

    <li class="nav-item">
      <a class="nav-link collapsed" href="/trip_planner">
        <i class="bi bi-map"></i>
        <span>Trip Planner</span>
      </a>
    </li>


    <!-- End Profile Page Nav -->

    <li class="nav-item">
      <a class="nav-link collapsed" href="/stops">
        <i class="bi bi-geo"></i>
        <span>Bus Stops</span>
      </a>
    </li><!-- End F.A.Q Page Nav -->

    <li class="nav-item">
      <a class="nav-link collapsed" href="/routes">
        <i class="glyphicon glyphicon-road"></i>
        <span>Bus Routes</span>
      </a>
    </li>

    <li class="nav-item">
      <a class="nav-link collapsed" href="/favourites">
        <i class="bi bi-star"></i>
        <span>Starred</span>
      </a>
    </li><!-- End Contact Page Nav -->

    <li class="nav-heading">Contact</li>

    <li class="nav-item">
      <a class="nav-link collapsed" href="/about">
        <i class="bi bi-info-circle"></i>
        <span>About Us</span>
      </a>
    </li><!-- End Login Page Nav -->

    <li class="nav-item">
      <a class="nav-link collapsed" href="/contact">
        <i class="bi bi-telephone"></i>
        <span>Contact Us</span>
      </a>
    </li><!-- End Error 404 Page Nav -->

    <li class="nav-heading">Others</li>

    <li class="nav-item">
      <a class="nav-link collapsed" href="/faq">
        <i class="bi bi-question-circle"></i>
        <span>F.A.Q</span>
      </a>
    </li><!-- End Blank Page Nav -->

  </ul>

</aside><!-- End Sidebar-->

<main id="main" class="main">

  <div class="row-pagetitle">
    <h1>Home</h1>

    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="#">Home</a></li>
        <li class="breadcrumb-item active">Dashboard</li>

      </ol>
    </nav>
  </div><!-- End Page Title -->

  <section class="section dashboard">
    <div class="row d-flex align-items-center justify-content-center" >

      <!-- Left side columns -->
      <div class="col-lg-11">
        <div class="row">

          <!-- Sales Card -->
          <div class="col-xxl-6 col-md-6">
            <div class="card info-card sales-card">

              <div class="card-body">
                <h5 class="card-title">Current Location</h5>

                <div class="d-flex align-items-center">
                  <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                    <i class="fas fa-map-marker-alt"></i>
                  </div>
                  <div class="ps-3">
                    <h6>Poonamallee</h6>
                    <span class="text-muted small pt-2 ps-1">Chennai</span>

                  </div>
                </div>
              </div>

            </div>
          </div><!-- End Sales Card -->

          <!-- Customers Card -->
          <div class="col-xxl-6 col-md-6">

            <div class="card info-card customers-card">
              <div class="card-body">
                <h5 class="card-title">Nearest Bus Stop</h5>

                <div class="d-flex align-items-center">
                  <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                    <i class="fas fa-bus"></i>
                  </div>
                  <div class="ps-3">
                    <h6>Poonamallee</h6>
                    <span class="text-warning small pt-1 fw-bold">200 mts</span> <span class="text-muted small pt-2 ps-1">Away</span>
                  </div>
                  <div class="filter" style = "margin-right: 30px;">
                    <a href="" style = "color: grey;"><i class="fas fa-compass" style="margin-right: 5px"></i>Directions</a>
                  </div>
                </div>

              </div>
            </div>

          </div><!-- End Customers Card -->

          <!-- Reports -->
          <div class="col-12">
            <div class="card">
              <div class="card-body" style = "min-height: 350px;">
                <h5 class="card-title">Buses Around You</h5>
                <div id="map"></div>
              </div>
            </div>
          </div><!-- End Reports -->
        </div>
      </div>
    </div>
  </section>
</main><!-- End #main -->


<a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

<!-- Vendor JS Files -->
<script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/vendor/chart.js/chart.umd.js"></script>
<script src="assets/vendor/echarts/echarts.min.js"></script>
<script src="assets/vendor/quill/quill.min.js"></script>
<script src=".assets/vendor/simple-datatables/simple-datatables.js"></script>
<script src="assets/vendor/tinymce/tinymce.min.js"></script>
<script src="assets/vendor/php-email-form/validate.js"></script>

<!-- Template Main JS File -->
<script src="assets/js/main.js"></script>

<!--<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBlPAuO-UMFC96BbZiVki6xn371eq0qMM0&libraries=places"></script>-->

<script>
        // Initialize and display the map
        function initMap() {
            var map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 13.049890, lng: 80.079025}, // Initial position
                zoom: 16
            });

            // Define the path for the first route
            var pathCoordinates1 = [
                {lat: 13.047280, lng: 80.080616}, // Starting point
                {lat: 13.047166, lng: 80.080187}, // Point 1
                {lat: 13.047065, lng: 80.079692}, // Point 2
                {lat: 13.047015, lng: 80.079240}, // Point 3
                {lat: 13.046916, lng: 80.076443}, // ...
                {lat: 13.046889, lng: 80.075435},
                {lat: 13.046778, lng: 80.074795},
                {lat: 13.046637, lng: 80.074427},
                {lat: 13.046407, lng: 80.073941},
                {lat: 13.046167, lng: 80.073354},
                {lat: 13.046045, lng: 80.072993},
                {lat: 13.045965, lng: 80.072241},
                {lat: 13.045888, lng: 80.071499},
                {lat: 13.045853, lng: 80.071354}, // Final point
                {lat: 13.045754, lng: 80.070983},
                {lat: 13.045489, lng: 80.070103},
                {lat: 13.044036, lng: 80.065047},
                {lat: 13.043851, lng: 80.064516}
            ];

            // Define the path for the second route
            // Add more paths as needed
            var pathCoordinates2 = [
                {lat: 13.052840, lng: 80.082484}, // Starting point
                {lat: 13.047762, lng: 80.084395},// ,
                {lat: 13.047568, lng: 80.084560}, //,
                {lat: 13.047415, lng: 80.084732}, //,
                {lat: 13.047301, lng: 80.084931}, //,
                {lat: 13.047286, lng: 80.085212} ,//,
                {lat: 13.047339, lng: 80.085427} ,//,
                {lat: 13.047430, lng: 80.085583} ,//,
                {lat: 13.047753, lng: 80.085833} ,//,
                {lat: 13.048130, lng: 80.085833} ,//,
                {lat: 13.048244, lng: 80.085790} ,//,
                {lat: 13.048442, lng: 80.085622} ,//,
                {lat: 13.048571, lng: 80.085439} ,//,
                {lat: 13.048613, lng: 80.085263} ,//,
                {lat: 13.048602, lng: 80.085127} ,//,
                {lat: 13.048666, lng: 80.085048} ,//,
                {lat: 13.048446, lng: 80.084240} ,//,
                {lat: 13.048040, lng: 80.083184} ,//,
                {lat: 13.047360, lng: 80.081009} ,//,
                {lat: 13.047159, lng: 80.080206} //,
            ];
             var pathCoordinates3 = [
                {lat: 13.048886, lng: 80.067128}, // Starting point
                {lat: 13.046100, lng: 80.069709}, // Point 1
                {lat: 13.045611, lng: 80.070434}, //,
                {lat: 13.046045, lng: 80.071622}, //,
                {lat: 13.046171, lng: 80.072747}, //,
                {lat: 13.046273, lng: 80.073253}, //,
                {lat: 13.046651, lng: 80.074107}, //,
                {lat: 13.046920, lng: 80.074737}, //,
                {lat: 13.047041, lng: 80.075564}, //,
                {lat: 13.047105, lng: 80.078388}, //,
                {lat: 13.047163, lng: 80.079465}, //,
                {lat: 13.047273, lng: 80.080093}, //,
                {lat: 13.047472, lng: 80.080789}, //,
                {lat: 13.047630, lng: 80.081457}, //,
                {lat: 13.047779, lng: 80.081948}, //,
                {lat: 13.047977, lng: 80.082576}, //,
                {lat: 13.048186, lng: 80.083118}, //,
                {lat: 13.048639, lng: 80.084260}, //,
                {lat: 13.048845, lng: 80.084758}, //,
                {lat: 13.049062, lng: 80.085878} //,
            ];
            var pathCoordinates4 = [
                {lat: 13.048918, lng: 80.086531}, // Starting point
                {lat: 13.048949, lng: 80.087073}, // Point 1
                {lat: 13.049043, lng: 80.087620}, //,,
                {lat: 13.049059, lng: 80.087808}, //,,
                {lat: 13.049347, lng: 80.088146}, //,,
                {lat: 13.049606, lng: 80.088482}, //,,
                {lat: 13.050513, lng: 80.089058}, //,,
                {lat: 13.051545, lng: 80.089616}
            ];


            // Add the first bus marker
            var busMarker1 = new google.maps.Marker({
                position: pathCoordinates1[0], // Start at the first point
                map: map,
                icon: {
                    url: 'assets/img/bus_icon.png', // Path to your bus icon
                    scaledSize: new google.maps.Size(40, 40) // Adjust the size as needed
                }
            });
            var busMarker2 = new google.maps.Marker({
                position: pathCoordinates2[0], // Start at the first point
                map: map,
                icon: {
                    url: 'assets/img/bus_icon.png', // Path to your bus icon
                    scaledSize: new google.maps.Size(40, 40) // Adjust the size as needed
                }
            });
            var busMarker3 = new google.maps.Marker({
                position: pathCoordinates3[0], // Start at the first point
                map: map,
                icon: {
                    url: 'assets/img/bus_icon.png', // Path to your bus icon
                    scaledSize: new google.maps.Size(40, 40) // Adjust the size as needed
                }
            });
            var busMarker4 = new google.maps.Marker({
                position: pathCoordinates4[0], // Start at the first point
                map: map,
                icon: {
                    url: 'assets/img/bus_icon.png', // Path to your bus icon
                    scaledSize: new google.maps.Size(40, 40) // Adjust the size as needed
                }
            });

            // Add the second bus marker
            // Add more markers as needed

            // Function to move the bus along a path
            function moveBusAlongPath(busMarker, path, duration) {
                var index = 0;
                var start = new Date().getTime();
                var totalDistance = google.maps.geometry.spherical.computeLength(path);
                var speed = totalDistance / duration;

                function animateBus() {
                    var now = new Date().getTime();
                    var elapsed = now - start;
                    var distance = elapsed * speed;

                    // Calculate the total length of the path
                    var totalLength = google.maps.geometry.spherical.computeLength(path);

                    // Calculate the fraction of the total distance covered
                    var fraction = distance / totalLength;

                    // Find the segment of the path that the bus is currently on
                    var currentDistance = totalLength * fraction;
                    var currentIndex = 0;
                    var currentLength = 0;
                    while (currentIndex < path.length - 1 && currentLength + google.maps.geometry.spherical.computeDistanceBetween(path[currentIndex], path[currentIndex + 1]) < currentDistance) {
                        currentLength += google.maps.geometry.spherical.computeDistanceBetween(path[currentIndex], path[currentIndex + 1]);
                        currentIndex++;
                    }

                    // Calculate the position of the bus along the current segment
                    var segmentFraction = (currentDistance - currentLength) / google.maps.geometry.spherical.computeDistanceBetween(path[currentIndex], path[currentIndex + 1]);
                    var newPosition = google.maps.geometry.spherical.interpolate(path[currentIndex], path[currentIndex + 1], segmentFraction);

                    // Update the position of the bus marker
                    busMarker.setPosition(newPosition);

                    // Continue animating if not reached the end of the path
                    if (elapsed < duration) {
                        requestAnimationFrame(animateBus);
                    }
                }


                animateBus();
            }

            // Example: Move the first bus along the first path in 150 seconds
            moveBusAlongPath(busMarker1, pathCoordinates1, 200000);
            moveBusAlongPath(busMarker2, pathCoordinates2, 200000);
            moveBusAlongPath(busMarker3, pathCoordinates3, 154000);
            moveBusAlongPath(busMarker4, pathCoordinates4, 200000);
            // Example: Move the second bus along the second path in 150 seconds
            // Add more function calls as needed

        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBlPAuO-UMFC96BbZiVki6xn371eq0qMM0&libraries=geometry&callback=initMap" async defer></script>

</body>

</html>